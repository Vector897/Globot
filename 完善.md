# 🚀 Globot 黑客松提交完善清单 (Gemini 3)

> **生成时间**: 2026-01-30
> **分析范围**: 整个项目代码库 (backend + frontend)

本文档列出了项目提交 **Google Gemini 3 黑客松** 前需要完善的关键问题和改进建议。

---

## 🔴 P0 - 必须修复 (Critical)

### 1. 缺失 Gemini API 集成
| 当前状态 | 问题描述 | 修复建议 |
| :--- | :--- | :--- |
| ❌ 未实现 | 整个项目中搜索不到任何 `gemini` 或 `google.generativeai` 的调用。`config.py` 中定义了 `google_api_key` 但未被使用。 | 在 `services/llm_service.py` 中添加 Gemini API 集成，或在 CrewAI 的 LLM 初始化中使用 `gemini/gemini-2.0-flash` 模型。 |

**涉及文件**:
- [config.py](file:///c:/Users/AIGCG/Desktop/RoSP_Hackthon2026-latest/backend/config.py#L33-34)
- [services/llm_service.py](file:///c:/Users/AIGCG/Desktop/RoSP_Hackthon2026-latest/backend/services/llm_service.py) (整个文件被注释)

---

### 2. LLM 服务完全失效
| 当前状态 | 问题描述 |
| :--- | :--- |
| ❌ 未工作 | `backend/services/llm_service.py` 中的所有代码（145 行）全部被注释掉。这意味着项目的 LLM 核心能力完全依赖 CrewAI 的内置配置，缺乏独立的 fallback。 |

**修复建议**:
1. 取消注释并重构为支持 Gemini。
2. 或删除此文件，在 CrewAI 配置中直接指定 Gemini 作为 LLM provider。

---

### 3. 敏感信息泄露 (安全漏洞)
| 文件 | 问题 |
| :--- | :--- |
| [backend/.env](file:///c:/Users/AIGCG/Desktop/RoSP_Hackthon2026-latest/backend/.env#L30) | 第 30 行明文写有：`密码：90807867`。这是严重的安全隐患。 |

**立即行动**:
1. 删除此行。
2. 将 `.env` 添加到 `.gitignore`（如果尚未添加）。
3. 检查 Git 历史，确保密码未被提交到远程仓库。

---

## 🟠 P1 - 强烈建议 (High Priority)

### 4. 前端缺少错误处理机制
| 当前状态 | 问题描述 |
| :--- | :--- |
| ⚠️ 不完善 | 在 `frontend/src/**/*.jsx` 和 `*.tsx` 中搜索 `catch` 或 `error`，返回结果为 **0**。这意味着前端几乎没有全局错误捕获或 `try-catch` 块。 |

**修复建议**:
- 在 `App.jsx` 或 `main.jsx` 中添加 React Error Boundary。
- 对所有 `fetch` 或 `axios` 调用添加 `.catch()` 处理。
- 考虑添加 Toast/Snackbar 组件统一展示错误信息。

---

### 5. 测试覆盖率极低
| 指标 | 值 |
| :--- | :--- |
| 测试文件数 | 2 个 (`test_demo.py`, `test_agent_logic_isolated.py`) |
| 预估覆盖率 | < 5% |

**修复建议**:
- 为 `maritime_routes.py` (68KB, 1700+ 行) 添加 API 路由测试。
- 为 CrewAI Agent 工作流添加集成测试。
- 添加前端组件测试 (使用 Vitest 或 React Testing Library)。

---

### 6. "Vessel not found" 用户体验问题
| 触发场景 | 描述 |
| :--- | :--- |
| 直接访问文档上传弹窗 | 用户在未选择船舶的情况下打开上传界面，会看到红色错误提示 `Vessel not found`，但没有引导用户如何解决。 |

**修复建议**:
- 在弹窗首次打开时检查 `vessel_id` 是否存在。
- 如果缺失，显示友好提示："请先从仪表盘选择一艘船舶，然后再上传文档。"
- 或禁用全局导航中的"上传文档"入口，仅在船舶详情页（有上下文）时可用。

---

### 7. `/usershome` 路由未受保护 (安全漏洞)
| 文件 | 问题 |
| :--- | :--- |
| [App.jsx](file:///c:/Users/AIGCG/Desktop/RoSP_Hackthon2026-latest/frontend/src/App.jsx#L53) | `/usershome` 路由直接渲染 `<UsersHome />`，**未包裹在 `<SignedIn>` 组件中**。这意味着未登录用户可以直接访问用户仪表盘。 |

**对比**:
```jsx
// ✅ 正确 (受保护的路由)
<Route path="/demo" element={
  <>
    <SignedIn><DemoPage /></SignedIn>
    <SignedOut><RedirectToSignIn /></SignedOut>
  </>
} />

// ❌ 错误 (未受保护)
<Route path="/usershome" element={<UsersHome />} />
```

**修复**:
将 `/usershome` 路由包裹在 `<SignedIn>` 中，或添加路由守卫。

---

### 8. 缺少全局 Vessel 状态管理
| 当前状态 | 问题描述 |
| :--- | :--- |
| ⚠️ 不完善 | 项目仅有 `HeaderContext` 管理页头状态。没有 `VesselContext` 或类似的全局状态来存储当前选中的船舶 ID。导致用户在不同页面间跳转时，船舶选择状态丢失。 |

**涉及文件**:
- [HeaderContext.tsx](file:///c:/Users/AIGCG/Desktop/RoSP_Hackthon2026-latest/frontend/src/context/HeaderContext.tsx) (唯一的 Context)
- [UsersHome.jsx](file:///c:/Users/AIGCG/Desktop/RoSP_Hackthon2026-latest/frontend/src/pages/UsersHome.jsx) (1280 行，包含大量本地状态)

**修复建议**:
创建 `VesselContext.tsx`，包含：
- `selectedVesselId`
- `vessels` (船舶列表缓存)
- `loadVessels()` / `selectVessel()` 方法

这样可以在文档上传、合规分析等多个模块间共享船舶选择状态。

---

## 🟡 P2 - 建议改进 (Medium Priority)

### 9. Demo 模式硬编码
| 文件 | 问题 |
| :--- | :--- |
| `backend/.env` | `DEMO_MODE=true` 被硬编码，且 Azure OpenAI 凭证使用占位符 `DEMO_KEY_NOT_USED`。 |

**建议**:
- 确保在演示结束后可以轻松切换到生产模式。
- 添加环境变量 `GEMINI_API_KEY` 并在代码中优先使用。

---

### 10. 代码中的 Monkey Patch
| 文件 | 问题 |
| :--- | :--- |
| [main.py](file:///c:/Users/AIGCG/Desktop/RoSP_Hackthon2026-latest/backend/main.py#L1-25) | 为了解决 `aiohttp` 与 CrewAI 的兼容性问题，在文件顶部使用了 Monkey Patch 定义 `ConnectionTimeout`, `ConnectionTimeoutError`, `SocketTimeoutError`。 |

**建议**:
- 这是一个临时解决方案。
- 长期应升级 `crewai` 或降级 `aiohttp` 到兼容版本，并移除 Monkey Patch。
- 在黑客松演示中可保留，但需在代码注释中说明原因。

---

### 11. 超大文件警告
| 文件 | 大小 | 建议 |
| :--- | :--- | :--- |
| `frontend/src/pages/UsersHome.jsx` | 68 KB | 拆分为多个子组件 |
| `backend/api/v2/maritime_routes.py` | 68 KB | 按功能拆分为独立路由模块 |
| `backend/services/maritime_knowledge_base.py` | 39 KB | 重构为更小的服务类 |

---

## 🟢 P3 - 锦上添花 (Nice to Have)

### 10. 文档和演示路径优化
| 类别 | 当前状态 | 建议 |
| :--- | :--- | :--- |
| README | 完善 (147 行) | 添加演示视频 GIF 或 YouTube 链接 |
| API 文档 | 未提供 | 添加 Swagger/OpenAPI 自动文档 (`/docs` 端点已由 FastAPI 自动生成，但未在 README 中提及) |
| 黑客松提交材料 | 未见 | 准备一页纸的项目概述 PDF，突出 AI Agent 能力 |

---

### 11. 国际化 (i18n)
README 和代码注释混合使用中英文。
**建议**: 
- 如果目标是国际评审，确保 UI 有英文版本。
- 如果是中国区评审，确保所有用户可见文本都已本地化。

---

## ✅ 已完成 (无需修改)

| 功能 | 状态 |
| :--- | :--- |
| CrewAI 多 Agent 集成 | ✅ 已实现 (5+ Agent 工作流) |
| Clerk 身份验证 | ✅ 已集成 |
| 3D/2D 地球可视化 (Deck.gl) | ✅ 已实现 |
| API 错误处理 (HTTPException) | ✅ 50+ 个错误处理点 |
| 模块化项目结构 | ✅ 清晰的 `core`, `services`, `api` 分层 |

---

## 📋 快速行动清单

1. [ ] **立即**: 删除 `.env` 中的密码，并检查 Git 历史
2. [ ] **1 小时内**: 在 `llm_service.py` 或 CrewAI 配置中集成 Gemini API
3. [ ] **2 小时内**: 修复 "Vessel not found" 的 UX 引导
4. [ ] **4 小时内**: 添加前端 Error Boundary
5. [ ] **演示前**: 准备一份 1 页项目概述 PDF

---

## 🎯 P0.5 - 战略层面完善 (基于策略文档)

> **参考来源**: `关于目标客户与产品定位的论述.txt` + `补充建议.md`

以下是根据项目战略定位文档提取的完善需求，直接影响评委对项目的技术印象分。

---

### 12. 🔴 缺失 Gemini 多模态能力展示 (Visual Risk)

| 当前状态 | 问题描述 |
| :--- | :--- |
| ❌ 未实现 | 策略文档明确要求："让 Gemini 直接看卫星云图或新闻视频，识别'苏伊士运河堵船'或'因为罢工堆积的集装箱'"。当前项目完全没有任何图像或视频分析功能。 |

**为什么重要**:
- 这是 Fuel/Price 传统模型做不到的，体现 AI 原生能力。
- 在 "Technical Execution (40%)" 和 "Innovation (30%)" 评分上构成差异化竞争力。

**修复建议**:
1. 创建 `backend/services/visual_risk_service.py`，调用 Gemini Vision API。
2. 添加功能：上传卫星云图 → Gemini 分析 → 识别港口拥堵/航道封锁。
3. 前端添加 "Visual Intelligence" 展示区域，显示图像和 AI 分析结果。

**涉及文件**:
- [NEW] `backend/services/visual_risk_service.py`
- [MODIFY] `frontend/src/components/AgentWorkflow.tsx` (添加视觉分析步骤)

---

### 13. 🔴 缺失长文档推理能力展示 (Long Context Window)

| 当前状态 | 问题描述 |
| :--- | :--- |
| ❌ 未实现 | 策略文档要求："丢给它 500 页的《海事保险条款》和最新的《地缘政治制裁名单》，让它自动判断某条航线是否合规"。当前 Compliance Manager 仅使用短文本 Mock 数据。 |

**为什么重要**:
- 完美展示 Gemini Long Context Window (2M tokens) 的核心竞争力。
- 将"合规检查"从简单的列表匹配升级为真正的文档理解。

**修复建议**:
1. 准备 1-2 份长篇 PDF 文档 (如：海事保险条款、MLC 2006 公约节选)。
2. 在 Compliance Manager Agent 中集成 Gemini 长文档分析 API。
3. 演示中展示：输入航线 → 自动分析条款 → 输出合规建议。

**涉及文件**:
- [NEW] `backend/data/documents/` (存放长文档)
- [MODIFY] `backend/services/mock_knowledge_base.py` → 替换为真实文档理解

---

### 14. 🟠 Risk Hedger 缺失财务损益计算

| 当前状态 | 问题描述 |
| :--- | :--- |
| ⚠️ 部分实现 | 策略文档期望："发生战争 → 建议改道 → **自动计算改道后的燃油成本增加和运费波动** → 给出包含财务损益的最终建议"。当前燃油/运费数据仅存在于 `cot_data.py` 的 Mock 中，**没有真正的计算逻辑**。 |

**修复建议**:
1. 在 Risk Hedger Agent 中添加 `calculate_reroute_cost()` 方法。
2. 输入参数：原航线、新航线、当前燃油价格指数。
3. 输出：额外燃油成本、延误天数、运费差价、总财务影响。
4. 在 CoT 面板中展示计算过程 (体现 Reasoning 能力)。

**涉及文件**:
- [MODIFY] `backend/demo/cot_data.py` (从静态数据改为动态计算)
- [MODIFY] `backend/core/` (添加成本计算工具)

---

### 15. 🟠 缺失 "Social Impact" (社会价值) 叙事

| 当前状态 | 问题描述 |
| :--- | :--- |
| ⚠️ 未提及 | 《补充建议》指出："不仅是帮大公司省钱，更是'保障民生'"。当前项目所有描述都围绕商业价值，缺少社会影响力的表述。 |

**修复建议 (无需改代码)**:
- 在路演和 PPT 的 "Potential Impact" 页面添加：
  > *"如果 Globot 能帮助马士基在红海危机中快速改道，这意味着：*
  > - *肯尼亚的粮食不会断供*
  > - *欧洲的天然气能够过冬*
  > - *医院的急救设备不会卡在港口"*
- 关键话术：*"We are not just optimizing spreadsheets; we are securing the lifelines of the global economy."*

**涉及文件**:
- [NEW] 路演 PPT 的 "Impact" 页面
- [MODIFY] `README.md` (在项目概览中添加社会价值描述)

---

### 16. 🟡 架构可插拔性未文档化

| 当前状态 | 问题描述 |
| :--- | :--- |
| ⚠️ 未说明 | 《补充建议》指出需强调"架构的真实性"：Reasoning Engine 是通用的，可接入 Bloomberg Terminal API 或 MarineTraffic API。但当前 README 和代码注释中完全没有提及。 |

**修复建议**:
1. 在 `README.md` 的技术架构部分添加 "Data Sources (Pluggable)" 说明。
2. 在代码中添加注释：`# Production: Replace with Bloomberg/MarineTraffic API`。
3. 回答评委质疑："数据哪里来？" → "我们的 Reasoning Engine 是通用的，Mock 数据是 Hackathon 限制，生产环境可直接对接 Bloomberg。"

**涉及文件**:
- [MODIFY] `README.md`
- [MODIFY] `backend/services/mock_knowledge_base.py` (添加 Production 替换注释)

---

### 17. 🟡 DeveloperWeek 资产复用未规划

| 当前状态 | 问题描述 |
| :--- | :--- |
| ⚠️ 未规划 | 策略文档提到 Molling 拆分提议用于 DeveloperWeek 2026。但当前项目没有明确的"货物拆分"功能边界和共享数据模型设计。 |

**修复建议**:
1. 确定 DeveloperWeek 项目聚焦 "Data Sensing (眼睛/手)"。
2. 确保两个项目共享 `backend/models.py` 中的核心数据模型。
3. 创建 `docs/asset_sharing.md` 记录复用策略。

**涉及文件**:
- [NEW] `docs/asset_sharing.md`
- `backend/models.py` (确保通用性)

---

## 📋 战略层行动清单

| 优先级 | 任务 | 预估耗时 | 负责人 |
| :---: | :--- | :---: | :---: |
| 🔴 P0 | 实现 Visual Risk (Gemini Vision 卫星图分析) | 4-6h | TBD |
| 🔴 P0 | 实现 Long Context 长文档合规分析 | 3-4h | TBD |
| 🟠 P1 | 添加 Risk Hedger 动态财务计算 | 2-3h | TBD |
| 🟠 P1 | 更新路演话术 + Social Impact 叙事 | 1h | TBD |
| 🟡 P2 | 文档化架构可插拔性 | 30min | TBD |
| 🟡 P2 | 规划 DeveloperWeek 资产复用 | 30min | TBD |
